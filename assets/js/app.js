$(".answer").each(function(a,b){noUiSlider.create(this,{start:[5],step:1,connect:[!0,!1],range:{min:0,max:10},pips:{mode:"steps",density:10}})});var countries=void 0,country_names=void 0;$.getJSON("/gagnvirkni/lifsgaedi/assets/data/qualityoflife.json",function(a){countries=a.countries,country_names=a.names});var category_result=function(a,b){var c='.category-result[data-category="'+a+'"]';$(c+" .country-appendix").text(_.map(b[2].key,function(a){return country_names[a].appendix}).join("/"));var d=$(c).width(),e=82,f=d3.scaleLinear().domain([0,10]).range([52,d-144]),g=d3.scaleLinear().domain([0,5]).range([7,e-7]),h=d3.selectAll(c+" > .category-viz").append("svg").attr("height",e).attr("width",d),i=h.selectAll("g").data(b).enter().append("g");i.append("line").attr("class",function(a){return a.class}).attr("x1",f(0)).attr("y1",function(a,b){return g(b)}).attr("x2",function(a){return f(a.value)}).attr("y2",function(a,b){return g(b)}),i.append("text").attr("font-size",10).attr("class",function(a){return a.class}).attr("text-anchor","end").attr("dominant-baseline","middle").attr("x",f(0)-2).attr("y",function(a,b){return g(b)}).text(function(a){return a.name}),i.append("text").attr("font-size",10).attr("dominant-baseline","middle").attr("class",function(a){return a.class}).attr("x",function(a){return f(a.value)+2}).attr("y",function(a,b){return g(b)}).text(function(a){return a.country?a.country:a.name})},overall_results=function(a,b,c){$("#mainresult .country-appendix").text(country_names[b].appendix);var d=800,e=$("#average").width(),f=20,g=d3.scaleLinear().domain([0,40]).range([f,d-2*f]),h=d3.scaleLinear().domain([0,10]).range([4*f,e-4*f]),i=d3.select("#average .average-result").append("svg").attr("class","compare").attr("height",d).attr("width",e),j=i.selectAll("g").data(a).enter().append("g");j.append("rect").attr("opacity",.5).attr("y",function(a,b){return g(4*b)+g(2)/2-4}).attr("x",function(a){return h(a.reference)-4}).attr("width",8).attr("height",8),j.append("text").attr("text-anchor","middle").attr("dominant-baseline","middle").attr("opacity",.22).attr("y",function(a,b){return g(4*b)+g(2)/4}).attr("x",function(a){return h(a.reference)}).text(function(a){return country_names[c].icelandic}),j.append("rect").attr("class",function(a){return a.name}).attr("opacity",.5).attr("y",function(a,b){return g(4*b)+g(2)/2-4}).attr("x",function(a){return h(a.closest)-4}).attr("width",8).attr("height",8),j.append("text").attr("class",function(a){return a.name}).attr("text-anchor","middle").attr("dominant-baseline","middle").attr("opacity",.5).attr("y",function(a,b){return g(4*b)+3*g(2)/4}).attr("x",function(a){return h(a.closest)}).text(function(a){return country_names[b].icelandic}),j.append("text").attr("class",function(a){return a.name}).attr("text-anchor","middle").attr("font-size",10).attr("opacity",.5).attr("dominant-baseline","middle").attr("y",function(a,b){return g(4*b)+g(2)/2}).attr("x",h(0)/2).text(function(a){return a.label}),j.append("text").attr("class",function(a){return a.name}).attr("text-anchor","middle").attr("font-size",10).attr("opacity",.5).attr("dominant-baseline","middle").attr("y",function(a,b){return g(4*b)+g(2)/2}).attr("x",e-(e-h(10))/2).text(function(a){return a.label}),j.append("line").attr("stroke","#ababab").attr("opacity",.5).attr("stroke-width",1).attr("x1",h(0)).attr("y1",function(a,b){return g(4*b)+g(2)/2}).attr("x2",h(10)).attr("y2",function(a,b){return g(4*b)+g(2)/2}),j.append("line").attr("class",function(a){return a.name}).attr("stroke-width",4).attr("x1",function(a){return h(a.you)}).attr("y1",function(a,b){return g(4*b)}).attr("x2",function(a){return h(a.you)}).attr("y2",function(a,b){return g(4*b)+g(2)}),j.append("text").attr("class",function(a){return a.name}).attr("text-anchor","middle").attr("dominant-baseline","bottom").attr("font-size",10).attr("dy",-2).attr("x",function(a){return h(a.you)}).attr("y",function(a,b){return g(4*b)}).text("Þitt svar")};$("#generate-results").click(function(a){var b={};$(this).hide(),$("#categories").show(),scrollTo("#categories"),$(".answer").each(function(a,c){var d=$(c).data("category"),e=$(c).data("label"),f=parseInt(this.noUiSlider.get());b[d]={value:f,label:e};var g=_.min(_.values(countries[d])),h=_.filter(_.keys(countries[d]),function(a){return countries[d][a]===g}),i=_.max(_.values(countries[d])),j=_.filter(_.keys(countries[d]),function(a){return countries[d][a]===i}),k=_.clone(countries[d]);_.each(k,function(a,b){k[b]=Math.abs(a-f)});var l=_.min(_.values(k)),m=_.filter(_.keys(k),function(a){return k[a]===l}),n=_.max(m,function(a){return countries[d][a]}),o=countries[d][n],p=[{name:"Minnst",class:"min",key:h,country:_.map(h,function(a){return country_names[a].icelandic}).join("/"),value:g},{name:"Þitt svar",class:"you",key:"you",country:void 0,value:f},{name:"Líkast þér",class:"closest",key:m,country:_.map(m,function(a){return country_names[a].icelandic}).join("/"),value:o},{name:country_names.iceland.icelandic,class:"iceland",key:"iceland",country:country_names.iceland.icelandic,value:countries[d].iceland},{name:"Mest",class:"max",key:j,country:_.map(j,function(a){return country_names[a].icelandic}).join("/"),value:i}];category_result(d,p)}),$("#mainresult").show(),$("#average").show();var c=_.mapObject(countries,function(a,c){return _.mapObject(a,function(a,d){return Math.abs(a-b[c].value)})}),d=_.reduce(_.values(c),function(a,b){return _.each(b,function(b,c){a[c]=(a[c]?a[c]:0)+b}),a},{}),e=_.min(_.pairs(d),function(a){return a[1]})[0],f=_.map(_.keys(b),function(a){return{name:a,label:b[a].label,you:b[a].value,reference:countries[a].iceland,closest:countries[a][e]}});overall_results(f,e,"iceland")});var scrollTo=function(a){var b=$(a);b=b.length?b:$("[name="+a.slice(1)+"]"),b.length&&$("html, body").animate({scrollTop:b.offset().top},1e3)};$(function(){$('a[href*="#"]:not([href="#"])').click(function(){return location.pathname.replace(/^\//,"")==this.pathname.replace(/^\//,"")&&location.hostname==this.hostname&&scrollTo(this.hash),!1})});var show_facebook=function(a,b,c){var d,e=a.getElementsByTagName(b)[0];a.getElementById(c)||(d=a.createElement(b),d.id=c,d.src="//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.8",e.parentNode.insertBefore(d,e))};